Network brigde trong KVM
Mục lục
Phần 1: Tổng quan
Phần 2: Kiến trúc
Phần 3: Cấu trúc và các thành phần
Phần 4: Hoạt động
1.	Tổng quan
-	Brigde là cách kết nôi 2 Ethernet segmet với nhau thông qua giao thức độc lập. Các Packet được chuyển tiếp dựa trên Ethenet address ( cụ thể là MAC address ) , khác với IP address (như router)
-	Bridged network sử dụng để chia sẻ mạng của thiết bị thật tới các Vm (VMs). Mỗi VM được cung cấp địa chỉ có sẵn của router tại dải mạng thực cung cấp cho host. Bridged networking cho phép VMs kết nối với mạng bên ngoài thông qua card mạng vật lý máy chủ.
Note :  Không hỗ trợ kết nối wireless

2.	Kiến trúc


Note : các khái niệm cơ bản 
•  Virtual switch port : là 1 port ảo trên switch ảo . 
•  vNIC ( virtual network interface card ): đóng vai trò là card mạng cho máy ảo 
• Uplink port : nhận toàn bộ lưu lương mạng ra/vào từ switch đến mạng bên ngoài
• Virtual Ethernet port
3.	Kiến trúc Linux bridge
 
Các thành phần :
1  Eth0: cổng mạng máy host
2  Tap0: interface kết nối giữa switch ảo đến các VM
3  Bridge : hoạt động tương tụ như switch ảo layer 2
4	Vfs ( virtual file system ): phân vùng ảo để chứa file , dữ liệu
5	Fd ( forward database ): giao tiếp nhận dữ liệu giữa máy ảo và bridge 
6	Read/write : dữ liệu được chuyển tiếp từ switch đến vfs

TAP interface : 
-	Trong ảo hóa port mạng của VM chỉ xử lí được các frame Ethernet khác với vNIC xử lí khung ethernet . Nó sẽ bóc lớp header và chỉ chuyển tiếp lớp payload tới OS. 
Cấu trúc khung Ethernet
 
-	Do đó tap interface sẽ hỗ trợ chuyển tiếp khung Ethernet vào máy ảo để xử lí được như 1 port mạng vật lí
4.	Hoạt động
Khi có  gói tin cần ra ngoài internet :
• Gói tin sẽ được chuyển qua cổng eth0 của VM
• Đi đến forward database từ cổng eth0
• Từ FD sẽ tiếp tục đến vfs
• Tại đây kernel sẽ lấy gói tin trong vfs chuyển đến bridge qua tap interface
• Bridge sẽ lấy gói tin chuyển ra internet qua cổng eth0 của máy host
5. Mô hình lab


